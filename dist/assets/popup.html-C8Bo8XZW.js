(function(){const m=document.createElement("link").relList;if(m&&m.supports&&m.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))v(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const T of r.addedNodes)T.tagName==="LINK"&&T.rel==="modulepreload"&&v(T)}).observe(document,{childList:!0,subtree:!0});function I(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function v(n){if(n.ep)return;n.ep=!0;const r=I(n);fetch(n.href,r)}})();document.addEventListener("DOMContentLoaded",()=>{const f=document.getElementById("downloadBtn"),m=document.getElementById("cancelBtn"),I=document.querySelector(".visualizer-container"),v=document.getElementById("cmdStatus"),n=document.getElementById("mainInterface"),r=document.getElementById("invalidState"),T=document.getElementById("bigPercent"),O=document.querySelector(".progress-ring__circle"),S=document.getElementById("speedVal"),D=document.getElementById("elapsedVal"),_=document.getElementById("chunksVal"),x=document.getElementById("statusVal"),C=document.getElementById("speedGraph"),o=C.getContext("2d"),i=new Array(60).fill(0);let h=0;const L=O.r.baseVal.value*2*Math.PI;O.style.strokeDasharray=`${L} ${L}`,O.style.strokeDashoffset=L;function w(t){const e=L-t/100*L;O.style.strokeDashoffset=e,T.textContent=Math.floor(t)}function y(t){v.textContent=`> ${t.toUpperCase()}`}function b(t){if(t===0)return"0 B";const e=1024,s=["B","KB","MB","GB"],u=Math.floor(Math.log(t)/Math.log(e));return parseFloat((t/Math.pow(e,u)).toFixed(1))+" "+s[u]}function R(t){h=h*(1-.2)+t*.2,i.shift(),i.push(h),o.clearRect(0,0,C.width,C.height);const s=Math.max(500*1024,...i),u=C.width,p=C.height,A=u/(i.length-1),d=a=>{const c=i[a]/s*(p*.9);return{x:a*A,y:p-c}};if(o.beginPath(),i.length>0){const a=d(0);o.moveTo(a.x,p),o.lineTo(a.x,a.y);for(let c=0;c<i.length-1;c++){const l=d(c),E=d(c+1),B=(l.x+E.x)/2,N=(l.y+E.y)/2;o.quadraticCurveTo(l.x,l.y,B,N)}const g=d(i.length-1);o.lineTo(g.x,g.y),o.lineTo(u,p)}if(o.fillStyle="rgba(237, 102, 46, 0.15)",o.fill(),o.beginPath(),i.length>0){const a=d(0);o.moveTo(a.x,a.y);for(let c=0;c<i.length-1;c++){const l=d(c),E=d(c+1),B=(l.x+E.x)/2,N=(l.y+E.y)/2;o.quadraticCurveTo(l.x,l.y,B,N)}const g=d(i.length-1);o.lineTo(g.x,g.y)}o.strokeStyle="#ed662e",o.lineWidth=2,o.lineJoin="round",o.stroke()}function M(t,e,s){if(x.textContent=t.toUpperCase(),x.className=t.includes("ERROR")||t.includes("FAIL")?"status-err":"status-ok",s&&s.throughput!==void 0){const u=s.throughput;R(u);const p=b(h)+"/s";S.textContent=p,h>1024*1024?S.className="neon-text":h<50*1024&&h>0?S.style.color="var(--neon-orange)":S.style.color="var(--text-bright)"}else e!==null&&(S.textContent=e.toFixed(1)+"x");s&&s.totalBytes!==void 0?_.textContent=b(s.totalBytes):s&&s.chunks&&(_.textContent=s.chunks+" CHUNKS")}chrome.runtime.onMessage.addListener(t=>{if(t.type==="HOTAUDIO_DOWNLOAD_STATUS_V2"){const{text:e,progress:s,speed:u,currentTime:p,chunks:A,totalBytes:d,throughput:a,startTime:g}=t;if(s>=0&&w(s),M(e,u,{chunks:A,totalBytes:d,throughput:a}),y(e),e==="COMPLETE"||e.includes("ERROR"))I.classList.remove("active"),f.disabled=!1,f.querySelector(".btn-content").textContent="RE-INITIALIZE",m.style.display="none";else if((e==="CAPTURING"||e==="STITCHING")&&(I.classList.add("active"),f.disabled=!0,f.querySelector(".btn-content").textContent="IN_PROGRESS...",m.style.display="block",t.startTime)){const c=Math.floor((Date.now()-t.startTime)/1e3),l=Math.floor(c/60).toString().padStart(2,"0"),E=(c%60).toString().padStart(2,"0");D.textContent=`${l}:${E}`}}else t.type==="HOTAUDIO_PLAYER_READY"&&(y("PLAYER_TARGET_LOCKED"),x.textContent="READY",x.classList.add("status-ok"))}),f.addEventListener("click",()=>{y("INITIATING_SEQUENCE..."),chrome.tabs.query({active:!0,currentWindow:!0},t=>{const e=t[0];e&&(chrome.scripting.executeScript({target:{tabId:e.id},world:"MAIN",files:["src/main_world.js"]},()=>{chrome.runtime.lastError?(console.error("Script injection failed: ",chrome.runtime.lastError),y("INJECTION_FAILED")):y("SEQUENCE_STARTED")}),chrome.tabs.sendMessage(e.id,{action:"start_download"}))})}),m.addEventListener("click",()=>{chrome.tabs.query({active:!0,currentWindow:!0},t=>{t[0]&&chrome.scripting.executeScript({target:{tabId:t[0].id,allFrames:!0},world:"MAIN",func:()=>{window.HOTAUDIO_CANCEL_DOWNLOAD&&window.HOTAUDIO_CANCEL_DOWNLOAD()}})}),I.classList.remove("active"),f.disabled=!1,f.querySelector(".btn-content").textContent="INITIALIZE_CAPTURE",m.style.display="none",y("ABORTED_BY_USER")}),chrome.tabs.query({active:!0,currentWindow:!0},t=>{const e=t[0];e&&e.url&&e.url.includes("hotaudio.net")?(y("SYSTEM_ONLINE"),n.classList.remove("hidden-state"),r.classList.add("hidden-state")):(n.classList.add("hidden-state"),r.classList.remove("hidden-state"))})});
